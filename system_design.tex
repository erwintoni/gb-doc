\Chapter{System Design}

\section{Design Overview}
GradeBadge uses a client-server architecture model, and it uses MVC (Model View Controller) architecute in the client and server side. And all incoming AJAX requests are submitted using HTTP POST and contain data encoded using JSON.    

\section{Model View Controller Architecture}
This application is based on Model View Controller (MVC) Architecture. Model View Controller (MVC) architecture is a software design pattern for separating different components of a software application.  \cite{MVC} There are three main categories in the MVC architecture:

\begin{itemize}
\item Model : it represents data in the application. All the business rules are handled in the model.
\item View: it represents UI components in the application. The UI components are responsible for presenting the model and for collecting user inputs.
\item Controller: it is responsible for updating the data in the model and notifying the view about changes in the model.
\end{itemize}

\section{Server-side Architecture Design}

All node js modules that start with req{\_}*.js are request handler that get requested from router.js. All ajax requests will go through req{\_}op.js, that verifies the user logged-in to Facebook and app{\_}version is current. Every req{\_}op.js request must contains Facebook access{\_}token and app{\_}version. If the user is not logged-in to Facebook, req{\_}op.js returns the following JSON document, {login:true}, if the version is not current, then req{\_}op.js return the following JSON document, {ver:true}. 

\begin{itemize}
\item .env : This is the setup file that contains environment variables. This file only exist in developer local environment, and these values in this file would be set in each Heroku environment config for staging and production.  
\item .gitignore: This is the setup file that contains list of files or folders that will be ignored when committing or pushing to git repositories. 
\item .slugignore: This is the setup file that contains list of files or folders that will be ignored when calculating the slug limit in Heroku
\item package.json: This is the setup file that contains of list of dependencies and engine version use in the application. This file also contains application name, version and description.
\item Procfile: This is the setup file that tells Heroku how to launch the application
\item main.js: This is the main module in node js, which contains the code that verify all neccessary environment variables are set correctly. It also invoke initialization in neccesarry modules to start the application, after the initialization is completed, it starts the HTTP request handling loop. 
\item router.js: This module routes incoming requests to the right module.
\item app{\_}ajax.js: This module contains the application wide AJAX handling routines
\item app{\_}http.js: This module contains all of HTTP protocol routines for the application, caching headers, compression header and other HTTP based optimization are implemented in this module.
\item fb.js: This module contains all code that interact with Facebook.
\item logger.js: This module contains application wide logging functionalities.
\item model.js: This module initializes the database connnection pool during server start 
\item req{\_}app.js: This module handles request for application HTML template for badge earner
\item req{\_}counter.js: This module handles request for logging counter 
\item req{\_}file.js: This module handles request for static content.
\item req{\_}issuer.js: This module handles request for application HTML template for badge issuers
\item req{\_}mem.js: This module handles request for memory usage
\item req{\_}root.js: This module handles request for static content under the root URL
\item req{\_}op.js : This module handles all AJAX request from client and routes to appropriate modules.  
\end{itemize}

\section{Mapping of Model Classes to MongoDB}
There will be one node js module to represent the mongoDB collection, named model{\_}(collection{\_}name).js. And many-to-many relationships are represented by linking documents, named (a){\_}(b){\_}links

\begin{itemize}
\item model{\_}group.js: this node.js module represents Groups collection
\item model{\_}badge.js: this node.js module represents Badges colletion
\item model{\_}user.js: this node.js module represents Users collection
\item model{\_}group{\_}admin.js: this node.js module represents group{\_}admin{\_}links collection
\item model{\_}group{\_}member.js: this node.js module represents group{\_}member{\_}links collection
\item model{\_}user{\_}badge.js: this node.js module represents user{\_}badge{\_}links collection
\item model{\_}group{\_}badge.js: this node.js module represents group{\_}badge{\_}links collection
\end{itemize}

\section{Request Handler Operation}
There will be one node js module to handle ajax request from client, named op{\_}(request).js. Every request may read, write or update to and from more than one collection

\begin{itemize}
\item op{\_}read{\_}badges{\_}by{\_}group.js: this operation is for request for all badges in the given group
\item op{\_}read{\_}groups{\_}by{\_}admin.js: this operation is for request for all groups in the given admin
\item op{\_}save{\_}badge.js: this operation is for request for saving given badge details
\item op{\_}save{\_}group.js: this operation is for request for saving given group details
\end{itemize}

\section{Client-side Architecutre Design}


\begin{itemize}
\item app.html : This is the html template for badge earner page
\item issuer.html : This is the html template for badge issuer page
\item public{\_}root/channel.html : This is the static content required by Facebook 
\item public{\_}root/favicon.ico : This is the statuc content for icon use in the browser
\item public{\_}ver/app.js : This is the client java-script  
\item public{\_}ver/style.css: This is the css file use
\end{itemize}



